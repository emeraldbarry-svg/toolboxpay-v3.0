<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toolbox Pay | v3.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root {
            --bg-deep: #05070A;
            --bg-panel: #0B0E14;
            --industrial-orange: #FF9500;
            --border-slate: #1E232D;
        }
        body { 
            background-color: var(--bg-deep); 
            color: #FFFFFF; 
            font-family: 'Inter', sans-serif; 
            margin: 0; 
            height: 100vh; 
            display: flex; 
            flex-direction: column; 
            overflow: hidden; 
        }
        /* FIXED ORANGE HEADER */
        .nav-pane {
            background-color: var(--bg-panel);
            border-bottom: 2px solid var(--industrial-orange);
            height: 65px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            justify-content: space-between;
            flex-shrink: 0;
            z-index: 1000;
        }
        .workspace { display: flex; flex: 1; overflow: hidden; }
        .config-sidebar {
            width: 400px;
            padding: 24px;
            border-right: 1px solid var(--border-slate);
            overflow-y: auto;
            background: #080A0F;
        }
        .industrial-input {
            background: #11141B;
            border: 1px solid var(--border-slate);
            border-radius: 4px;
            color: white;
            padding: 12px;
            width: 100%;
            outline: none;
            font-size: 13px;
            margin-bottom: 16px;
        }
        .industrial-input:focus { border-color: var(--industrial-orange); }
        .info-label {
            font-size: 10px;
            font-weight: 900;
            color: #4B5563;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            display: block;
            margin-bottom: 5px;
        }
        /* INVOICE PAPER LOOK */
        .invoice-paper {
            background: white;
            color: #1a1a1a;
            width: 100%;
            max-width: 800px;
            min-height: 1100px;
            box-shadow: 0 40px 80px rgba(0,0,0,0.6);
            padding: 80px 60px;
            margin: 40px auto;
            display: flex;
            flex-direction: column;
        }
        @media print {
            body * { visibility: hidden; }
            #invoiceSheet, #invoiceSheet * { visibility: visible; }
            #invoiceSheet { position: absolute; left: 0; top: 0; width: 100%; box-shadow: none; margin: 0; }
        }
    </style>
</head>
<body>

    <nav class="nav-pane">
        <div class="flex items-center gap-2">
            <span class="font-black text-xl tracking-tighter uppercase">
                <span class="text-[#FF9500]">TOOLBOX</span>PAY 
            </span>
        </div>
        <button onclick="window.print()" class="bg-[#FF9500] text-black px-6 py-2 rounded font-black text-xs uppercase shadow-lg shadow-orange-500/20">Print Invoice</button>
    </nav>

    <div class="workspace">
        <aside class="config-sidebar">
            <h2 class="text-orange-500 font-black text-sm uppercase mb-6">Invoice Setup</h2>
            
            <span class="info-label">Customer Name</span>
            <input type="text" id="custName" class="industrial-input" placeholder="e.g. Emerald Barry">

            <span class="info-label">Site Address</span>
            <textarea id="custAddr" class="industrial-input" rows="3" placeholder="Address..."></textarea>

            <span class="info-label">Work Description (AI Assistant)</span>
            <textarea id="workDesc" class="industrial-input" style="min-height: 140px;" placeholder="e.g. 100 labour and 50 parts"></textarea>

            <div class="grid grid-cols-2 gap-4">
                <div>
                    <span class="info-label">Labour (£)</span>
                    <input type="number" id="labourCost" class="industrial-input" value="0">
                </div>
                <div>
                    <span class="info-label">Parts (£)</span>
                    <input type="number" id="partsCost" class="industrial-input" value="0">
                </div>
            </div>

            <div class="mt-8 pt-8 border-t border-slate-800">
                <span class="info-label">Your Business Name</span>
                <input type="text" id="bizName" class="industrial-input">
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <span class="info-label">Sort Code</span>
                        <input type="text" id="bankSort" class="industrial-input" placeholder="00-00-00">
                    </div>
                    <div>
                        <span class="info-label">Account No</span>
                        <input type="text" id="bankAcc" class="industrial-input" placeholder="00000000">
                    </div>
                </div>
            </div>
        </aside>

        <main class="flex-1 bg-[#020305] overflow-y-auto p-12 flex justify-center">
            <div class="invoice-paper" id="invoiceSheet">
                </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const inputs = ['custName', 'custAddr', 'workDesc', 'labourCost', 'partsCost', 'bizName', 'bankSort', 'bankAcc'];
            const el = {};
            inputs.forEach(id => el[id] = document.getElementById(id));
            el.invoiceSheet = document.getElementById('invoiceSheet');

            const VAT_RATE = 0.20;

            function update() {
                let text = el.workDesc.value.toUpperCase();
                let scrubbed = el.workDesc.value.toUpperCase();

                // 1. LABOUR EXTRACTION
                const labMatch = text.match(/(?:£?\s*(\d+(?:\.\d+)?)\s*(?:POUNDS?|£)?\s*LABOUR)|(?:LABOUR\s*(?:AT|IS|OF|FOR)?\s*(?:£|POUNDS?)?\s*(\d+(?:\.\d+)?))/i);
                if (labMatch) {
                    el.labourCost.value = labMatch[1] || labMatch[2];
                    scrubbed = scrubbed.replace(labMatch[0], "");
                }

                // 2. PARTS EXTRACTION
                const partMatch = text.match(/(?:£?\s*(\d+(?:\.\d+)?)\s*(?:POUNDS?|£)?\s*(?:PARTS|TOOLS|MATERIALS))|(?:(?:PARTS|TOOLS|MATERIALS)\s*(?:AT|IS|OF|FOR)?\s*(?:£|POUNDS?)?\s*(\d+(?:\.\d+)?))/i);
                if (partMatch) {
                    el.partsCost.value = partMatch[1] || partMatch[2];
                    scrubbed = scrubbed.replace(partMatch[0], "");
                }

                // Formatting Cleanup
                scrubbed = scrubbed.replace(/AT A COST OF|TOTALING|COSTING|AND|PLUS|FOR/gi, "").replace(/\s\s+/g, ' ').trim();

                const lab = parseFloat(el.labourCost.value) || 0;
                const prt = parseFloat(el.partsCost.value) || 0;
                const sub = lab + prt;
                const vat = sub * VAT_RATE;
                const tot = sub + vat;

                // 3. RENDER INVOICE
                el.invoiceSheet.innerHTML = `
                    <div class="flex justify-between items-start mb-20">
                        <div>
                            <h1 class="text-2xl font-black tracking-tighter uppercase"><span class="text-[#FF9500]">TOOLBOX</span>PAY</h1>
                            <div class="mt-4 text-[11px] font-bold text-slate-500 uppercase">${el.bizName.value || 'YOUR BUSINESS NAME'}<br>SPECIALISING IN TRADE</div>
                        </div>
                        <div class="text-right">
                            <h2 class="text-4xl font-light text-slate-100 uppercase tracking-tighter">Invoice</h2>
                            <div class="text-[10px] font-black text-slate-400 mt-2 uppercase">${new Date().toLocaleDateString('en-GB')}</div>
                        </div>
                    </div>

                    <div class="mb-16 border-l-4 border-[#FF9500] pl-8 py-2 bg-slate-50">
                        <div class="text-[9px] font-black text-slate-400 uppercase tracking-widest mb-2">Invoice To:</div>
                        <div class="text-lg font-bold text-slate-900 uppercase tracking-tight">${el.custName.value || '---'}</div>
                        <div class="text-[11px] text-slate-600 uppercase mt-1 leading-relaxed">${el.custAddr.value.replace(/\n/g, '<br>') || '---'}</div>
                    </div>

                    <div class="flex-1">
                        <div class="text-[9px] font-black text-slate-300 uppercase tracking-widest mb-4 border-b pb-2">Description of Works</div>
                        <div class="text-[13px] font-medium text-slate-800 leading-relaxed uppercase mb-20 min-h-[160px]">${scrubbed || 'Awaiting Job Notes...'}</div>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between text-base border-b border-slate-100 pb-4">
                                <span class="text-slate-400 font-bold uppercase tracking-tight">Professional Labour</span>
                                <span class="font-bold">£${lab.toFixed(2)}</span>
                            </div>
                            <div class="flex justify-between text-base border-b border-slate-100 pb-4">
                                <span class="text-slate-400 font-bold uppercase tracking-tight">Materials & Parts</span>
                                <span class="font-bold">£${prt.toFixed(2)}</span>
                            </div>
                        </div>
                    </div>

                    <div class="mt-24 flex justify-end">
                        <div class="w-72">
                            <div class="flex justify-between text-[11px] mb-3 font-bold text-slate-400 uppercase"><span>Subtotal</span><span>£${sub.toFixed(2)}</span></div>
                            <div class="flex justify-between text-[11px] mb-8 font-bold text-slate-400 uppercase border-b-2 border-slate-100 pb-5"><span>VAT (20%)</span><span>£${vat.toFixed(2)}</span></div>
                            <div class="flex justify-between items-center"><span class="text-[11px] font-black uppercase text-slate-400">Total Due</span><span class="text-5xl font-black text-[#FF9500]">£${tot.toFixed(2)}</span></div>
                        </div>
                    </div>

                    <div class="mt-auto pt-12 grid grid-cols-2 gap-12 border-t border-slate-100 pb-4">
                        <div>
                            <div class="text-[9px] font-black text-slate-300 uppercase mb-4 tracking-widest">Bank Details</div>
                            <div class="text-[11px] font-bold uppercase">SORT CODE: ${el.bankSort.value || '00-00-00'}<br>ACCOUNT: ${el.bankAcc.value || '00000000'}</div>
                        </div>
                        <div class="text-right">
                            <div class="text-[9px] font-black text-slate-300 uppercase mb-4 tracking-widest">Terms</div>
                            <div class="text-[11px] font-bold uppercase">Payment due on receipt.<br>Thank you for your custom.</div>
                        </div>
                    </div>
                `;
            }

            inputs.forEach(id => el[id].addEventListener('input', update));
            update();
        });
    </script>
</body>
</html>
