<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>toolboxpay v11.0</title>
    <style>
        body { font-family: sans-serif; margin: 0; padding: 15px; background: #fff; color: #000; }
        .logo { color: #ff6600; font-weight: 800; font-size: 26px; text-align: center; margin-bottom: 25px; }
        .logo span { color: #000; }
        .screen { display: none; }
        .active { display: block !important; }
        /* Buttons use native OS rendering to prevent "skewing" */
        button { width: 100%; padding: 22px; margin-bottom: 12px; font-size: 16px; font-weight: bold; cursor: pointer; border: 1px solid #ccc; border-radius: 8px; background: #f2f2f2; text-align: left; display: block; }
        .btn-org { background: #ff6600; color: white; border: none; text-align: center; }
        .btn-back { background: #fff; border: 1px solid #ff6600; color: #ff6600; text-align: center; padding: 12px; }
        input, textarea, select { width: 100%; padding: 16px; margin: 8px 0 15px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; display: block; }
        .total-box { text-align: right; font-size: 30px; font-weight: 800; color: #ff6600; margin: 15px 0; }
        .receipt { border: 2px solid #000; padding: 15px; font-size: 14px; background: #fff; line-height: 1.4; }
    </style>
</head>
<body>

    <div class="logo">toolbox<span>pay</span></div>

    <div id="m" class="screen active">
        <button onclick="document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById('c').classList.add('active');">NEW QUOTE →</button>
        <button onclick="document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById('h').classList.add('active'); loadH();">HISTORY →</button>
        <button onclick="document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById('s').classList.add('active');">BUSINESS SETUP →</button>
        <button onclick="document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById('b').classList.add('active');">BANK DETAILS →</button>
    </div>

    <div id="c" class="screen">
        <button class="btn-back" onclick="location.reload()">← BACK</button>
        <input type="text" id="cn" placeholder="Client Name">
        <input type="number" id="hrs" placeholder="Hours" oninput="runM()">
        <input type="number" id="rte" placeholder="Rate" oninput="runM()">
        <input type="number" id="mat" placeholder="Materials" oninput="runM()">
        <div id="res" class="total-box">£0.00</div>
        <button class="btn-org" onclick="saveQ()">SAVE QUOTE</button>
    </div>

    <div id="h" class="screen">
        <button class="btn-back" onclick="location.reload()">← BACK</button>
        <div id="h-list"></div>
    </div>

    <div id="s" class="screen">
        <button class="btn-back" onclick="location.reload()">← BACK</button>
        <label style="font-size:12px;font-weight:bold;">Currency</label>
        <select id="cur" onchange="localStorage.setItem('cur', this.value)">
            <option value="£">British Pound (£)</option>
            <option value="$">US Dollar ($)</option>
            <option value="€">Euro (€)</option>
        </select>
        <input type="text" id="bn" placeholder="Business Name" oninput="localStorage.setItem('bn', this.value)">
        <textarea id="ba" placeholder="Address" oninput="localStorage.setItem('ba', this.value)"></textarea>
    </div>

    <div id="b" class="screen">
        <button class="btn-back" onclick="location.reload()">← BACK</button>
        <input type="text" id="b1" placeholder="Account Name" oninput="localStorage.setItem('b1', this.value)">
        <input type="text" id="b2" placeholder="Sort Code" oninput="localStorage.setItem('b2', this.value)">
        <input type="text" id="b3" placeholder="Account Number" oninput="localStorage.setItem('b3', this.value)">
        <input type="url" id="bl" placeholder="Payment Link" oninput="localStorage.setItem('bl', this.value)">
    </div>

    <div id="v" class="screen">
        <button class="btn-back" onclick="document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active')); document.getElementById('h').classList.add('active');">← BACK</button>
        <div id="vc" class="receipt"></div>
        <div id="pa"></div>
        <button class="btn-org" style="margin-top:10px" onclick="window.print()">PRINT / PDF</button>
    </div>

    <script>
        function runM() {
            var sy = localStorage.getItem('cur') || '£';
            var h = Number(document.getElementById('hrs').value) || 0;
            var r = Number(document.getElementById('rte').value) || 0;
            var m = Number(document.getElementById('mat').value) || 0;
            document.getElementById('res').innerText = sy + ( (h*r)+m ).toFixed(2);
        }

        function saveQ() {
            var sy = localStorage.getItem('cur') || '£';
            var h = Number(document.getElementById('hrs').value) || 0;
            var r = Number(document.getElementById('rte').value) || 0;
            var m = Number(document.getElementById('mat').value) || 0;
            var t = (h*r)+m;
            var j = JSON.parse(localStorage.getItem('jobs') || '[]');
            j.unshift({id: Date.now(), n: document.getElementById('cn').value||'Client', t: sy+t.toFixed(2), d: new Date().toLocaleDateString('en-GB')});
            localStorage.setItem('jobs', JSON.stringify(j.slice(0,20)));
            location.reload();
        }

        function loadH() {
            var j = JSON.parse(localStorage.getItem('jobs') || '[]');
            document.getElementById('h-list').innerHTML = j.map(function(x) {
                return '<button onclick="openQ('+x.id+')">'+x.n+'<br><small style="color:#666;">'+x.d+' - '+x.t+'</small></button>';
            }).join('') || '<p style="text-align:center;">No history found.</p>';
        }

        function openQ(id) {
            var j = JSON.parse(localStorage.getItem('jobs')||'[]').find(function(x){return x.id === id;});
            if(!j) return;
            document.getElementById('vc').innerHTML = '<strong>'+(localStorage.getItem('bn')||'Business')+'</strong><br>'+(localStorage.getItem('ba')||'')+'<hr>Client: '+j.n+'<br>Date: '+j.d+'<br><strong>Total: '+j.t+'</strong><hr>Bank: '+(localStorage.getItem('b1')||'')+'<br>Sort: '+(localStorage.getItem('b2')||'')+'<br>Acc: '+(localStorage.getItem('b3')||'');
            var lnk = localStorage.getItem('bl');
            document.getElementById('pa').innerHTML = lnk ? '<button class="btn-org" style="background:#2ecc71; margin-top:10px;" onclick="window.open(\''+lnk+'\',\'_blank\')">PAY NOW</button>' : '';
            document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
            document.getElementById('v').classList.add('active');
        }

        window.onload = function() {
            ['bn','ba','b1','b2','b3','bl','cur'].forEach(function(k) {
                var v = localStorage.getItem(k);
                if(v && document.getElementById(k)) { document.getElementById(k).value = v; }
            });
