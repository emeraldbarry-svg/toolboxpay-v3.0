<!DOCTYPE html>
<html lang="en-GB">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>toolboxpay v15.0</title>
    <style>
        /* THE ULTIMATE RESET: No containers, no floats, no flex. Just vertical blocks. */
        body { font-family: sans-serif; padding: 15px; background: #fff; color: #000; margin: 0; }
        .logo-box { color: #ff6600; font-weight: 900; font-size: 24px; text-align: center; margin-bottom: 20px; }
        
        /* Direct Block Buttons: These cannot skew as they follow the screen width naturally */
        .btn-link { display: block; width: 100%; padding: 22px; margin-bottom: 12px; background: #f4f4f4; border: 1px solid #ddd; border-radius: 8px; font-size: 16px; font-weight: bold; color: #ff6600; text-decoration: none; box-sizing: border-box; }
        .btn-save { background: #ff6600; color: #fff; border: none; text-align: center; }
        .btn-back { background: #fff; border: 1px solid #ff6600; color: #ff6600; text-align: center; padding: 10px; font-size: 14px; margin-bottom: 20px; }

        .view-panel { display: none; }
        .view-panel:target { display: block !important; }
        #home:not(:target) { display: block; }
        .view-panel:target ~ #home { display: none; }

        input, textarea, select { width: 100%; padding: 16px; margin: 8px 0 15px 0; border: 1px solid #ccc; border-radius: 6px; font-size: 16px; box-sizing: border-box; display: block; }
        .total-text { text-align: right; font-size: 32px; font-weight: 900; color: #ff6600; padding: 10px 0; }
        .receipt-card { border: 2px solid #000; padding: 15px; background: #fff; font-size: 14px; line-height: 1.5; }
    </style>
</head>
<body>

    <div class="logo-box">toolboxpay</div>

    <div id="home" class="view-panel">
        <a href="#quote" class="btn-link">NEW QUOTE →</a>
        <a href="#history" class="btn-link" onclick="drawH()">HISTORY →</a>
        <a href="#setup" class="btn-link">BUSINESS SETUP →</a>
        <a href="#bank" class="btn-link">BANK DETAILS →</a>
        <button onclick="localStorage.clear(); location.reload();" style="width:100%; background:none; border:none; color:#999; font-size:10px; margin-top:40px;">FORCE APP RESET (CLEARS ALL DATA)</button>
    </div>

    <div id="quote" class="view-panel">
        <a href="#" class="btn-link btn-back">← BACK TO MENU</a>
        <input type="text" id="c_name" placeholder="Client Name">
        <input type="number" id="c_hrs" placeholder="Labour Hours" oninput="calc()">
        <input type="number" id="c_rte" placeholder="Hourly Rate" oninput="calc()">
        <input type="number" id="c_mat" placeholder="Materials Cost" oninput="calc()">
        <div id="c_total" class="total-text">£0.00</div>
        <button class="btn-link btn-save" onclick="saveQ()">SAVE QUOTE</button>
    </div>

    <div id="history" class="view-panel">
        <a href="#" class="btn-link btn-back">← BACK TO MENU</a>
        <div id="history-target"></div>
    </div>

    <div id="setup" class="view-panel">
        <a href="#" class="btn-link btn-back">← BACK TO MENU</a>
        <label style="font-size:11px; font-weight:bold;">CURRENCY</label>
        <select id="s_cur" onchange="localStorage.setItem('v15_cur', this.value)">
            <option value="£">GBP (£)</option>
            <option value="$">USD ($)</option>
            <option value="€">EUR (€)</option>
        </select>
        <input type="text" id="s_bn" placeholder="Business Name" oninput="localStorage.setItem('v15_bn', this.value)">
        <textarea id="s_ba" placeholder="Business Address" oninput="localStorage.setItem('v15_ba', this.value)"></textarea>
    </div>

    <div id="bank" class="view-panel">
        <a href="#" class="btn-link btn-back">← BACK TO MENU</a>
        <input type="text" id="s_b1" placeholder="Account Name" oninput="localStorage.setItem('v15_b1', this.value)">
        <input type="text" id="s_b2" placeholder="Sort Code" oninput="localStorage.setItem('v15_b2', this.value)">
        <input type="text" id="s_b3" placeholder="Account Number" oninput="localStorage.setItem('v15_b3', this.value)">
        <input type="url" id="s_bl" placeholder="Payment Link" oninput="localStorage.setItem('v15_bl', this.value)">
    </div>

    <div id="view" class="view-panel">
        <a href="#history" class="btn-link btn-back">← BACK TO HISTORY</a>
        <div id="v-target" class="receipt-card"></div>
        <div id="p-target"></div>
        <button class="btn-link btn-save" style="margin-top:15px" onclick="window.print()">SAVE AS PDF</button>
    </div>

    <script>
        const pfx = "v15_";

        function calc() {
            var sym = localStorage.
